<app-page-title title="Kontakt"></app-page-title>
<section class="contact">
  <div class="container page-animate" #formContainer>

    <div class="contact__grid">

      <!-- Mobile: Selected Service (above form) -->
      <div class="mobile-service-badge" *ngIf="selectedService">
        <span class="mobile-service-badge__emoji">{{ selectedService.icon }}</span>
        <span class="mobile-service-badge__title">{{ selectedService.title }}</span>
        <button class="mobile-service-badge__remove" (click)="clearSelectedService()" aria-label="Service entfernen">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>

      <!-- Sidebar -->
      <aside class="contact__sidebar">

        <!-- Selected Service Card (Desktop) -->
        <div class="selected-service" *ngIf="selectedService">
          <div class="selected-service__header">
            <span class="selected-service__emoji">{{ selectedService.icon }}</span>
            <div class="selected-service__info">
              <span class="selected-service__label">Ausgew√§hlter Service</span>
              <h4 class="selected-service__title">{{ selectedService.title }}</h4>
            </div>
            <button class="selected-service__remove" (click)="clearSelectedService()" aria-label="Entfernen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
          <p class="selected-service__desc">{{ selectedService.description }}</p>
        </div>

        <!-- Quick Contact -->
        <!-- <div class="quick-contact">
          <h3>Schneller Kontakt</h3>
          <div class="quick__list">
            <a class="quick__card" href="mailto:hi@leonards-brandenburger-it.de">
              <div class="quick__icon">
                <span class="material-symbols-outlined ms-fill">mail</span>
              </div>
              <div class="quick__content">
                <span class="quick__title">E-Mail schreiben</span>
                <span class="quick__value">hi&#64;leonards-brandenburger-it.de</span>
              </div>
            </a>
          </div>
        </div> -->

        <!-- Info Card -->
        <div class="info-card">
          <div class="info-card__icon">
            <span class="material-symbols-outlined ms-fill">info</span>
          </div>
          <h3>Was passiert als N√§chstes?</h3>
          <ul class="info-list">
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Wir melden uns innerhalb von 24h</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Wir kl√§ren deine Anforderungen</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Du bekommst eine ehrliche Einsch√§tzung</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Keine Verpflichtung, keine versteckten Kosten</span>
            </li>
          </ul>
        </div>

        <!-- Trust Badge -->
        <div class="trust-badge">
          <span class="material-symbols-outlined">verified</span>
          <div>
            <strong>Zufriedenheitsgarantie</strong>
            <p>14 Tage Geld-zur√ºck bei Unzufriedenheit</p>
          </div>
        </div>

      </aside>

      <!-- Main Content -->
      <div class="contact__main">

        <!-- Success State -->
        <div class="success-card" *ngIf="state === 'success'" role="status" aria-live="polite" #successCard>
          <div class="success-icon">
            <span class="material-symbols-outlined ms-fill">celebration</span>
          </div>
          <h2>Danke! Nachricht angekommen. üéâ</h2>
          <p>Wir melden uns innerhalb von 24 Stunden bei dir.</p>
          <div class="success-actions">
            <button class="btn btn--primary" type="button" (click)="newMessage()">
              <span class="material-symbols-outlined ms-size-20">add</span>
              Neue Nachricht
            </button>
            <button class="btn btn--ghost" type="button" (click)="router.navigate(['/'])">
              <span class="material-symbols-outlined ms-size-20">home</span>
              Zur Startseite
            </button>
          </div>
        </div>

        <!-- Form -->
        <form class="contact__form" *ngIf="state !== 'success'" (ngSubmit)="submit()" #f="ngForm" novalidate
          [class.is-loading]="busy" [attr.aria-busy]="busy" (keydown)="onKeydown($event)">

          <div class="form-header">
            <h2>Schnelle Nachricht</h2>
            <p class="form-subtitle" *ngIf="selectedService">
              Anfrage zu: <strong>{{ selectedService.title }}</strong>
            </p>
            <p class="form-subtitle" *ngIf="!selectedService">
              Wir freuen uns auf deine Nachricht!
            </p>
          </div>

          <!-- Name -->
          <div class="field" [class.has-error]="f.submitted && !model.name" [class.has-value]="model.name">
            <label for="name">
              Dein Name
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">person</span>
              <input #nameInput id="name" name="name" type="text" [(ngModel)]="model.name" placeholder="Max Mustermann" required
                [disabled]="busy" autocomplete="name" />
              <span class="input-check material-symbols-outlined" *ngIf="model.name">check_circle</span>
            </div>
            <small *ngIf="f.submitted && !model.name" class="error-message">
              <span class="material-symbols-outlined">error</span>
              Bitte Namen angeben
            </small>
          </div>

          <!-- Email -->
          <div class="field" [class.has-error]="f.submitted && !model.email" [class.has-value]="model.email">
            <label for="email">
              E-Mail
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">mail</span>
              <input id="email" name="email" type="email" [(ngModel)]="model.email" placeholder="max@beispiel.de"
                required [disabled]="busy" autocomplete="email" inputmode="email" />
              <span class="input-check material-symbols-outlined" *ngIf="model.email">check_circle</span>
            </div>
            <small *ngIf="f.submitted && !model.email" class="error-message">
              <span class="material-symbols-outlined">error</span>
              Bitte E-Mail angeben
            </small>
          </div>

          <!-- Message -->
          <div class="field" [class.has-error]="f.submitted && !model.message" [class.has-value]="model.message">
            <label for="message">
              Worum geht's?
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <textarea id="message" name="message" rows="4" [(ngModel)]="model.message"
                [maxlength]="messageMaxLength" required
                [placeholder]="selectedService 
                  ? 'Erz√§hl uns mehr √ºber dein Projekt mit ' + selectedService.title + '...' 
                  : 'Schreib uns hier deine Frage oder dein Anliegen...'"
                [disabled]="busy"></textarea>
            </div>
            <div class="field-footer">
              <small class="char-counter" [class.near-limit]="isMessageNearLimit">
                {{ messageLength }} / {{ messageMaxLength }}
              </small>
            </div>
            <small *ngIf="f.submitted && !model.message" class="error-message">
              <span class="material-symbols-outlined">error</span>
              Bitte beschreib kurz dein Anliegen
            </small>
          </div>

          <!-- Callback Toggle -->
          <div class="field field--checkbox">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="model.callback" name="callback" [disabled]="busy" />
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">
                <span class="material-symbols-outlined">call</span>
                Lieber R√ºckruf statt E-Mail?
              </span>
            </label>
          </div>

          <!-- Phone (conditional) -->
          <div class="field field--phone" *ngIf="model.callback" @slideDown>
            <label for="phone">Telefonnummer</label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">phone</span>
              <input id="phone" type="tel" name="phone" [(ngModel)]="model.phone" placeholder="+49 123 456789"
                [disabled]="busy" inputmode="tel" autocomplete="tel" />
            </div>
          </div>

          <!-- Submit -->
          <div class="form-actions" #submitButton>
            <button class="btn btn--primary btn--large btn--submit" type="submit" [disabled]="busy">
              <span *ngIf="!busy" class="btn-content">
                <span class="material-symbols-outlined ms-size-20">send</span>
                <span>Nachricht senden</span>
              </span>
              <span *ngIf="busy" class="loading-content">
                <span class="spinner"></span>
                <span>Wird gesendet‚Ä¶</span>
              </span>
            </button>
            <p class="form-meta">
              <span class="material-symbols-outlined">bolt</span>
              Antwort in der Regel innerhalb von 24h
            </p>
          </div>

          <!-- Privacy -->
          <p class="privacy-notice">
            <span class="material-symbols-outlined">shield</span>
            Mit dem Absenden stimmst du der Verarbeitung deiner Daten zur Bearbeitung deiner Anfrage zu.
            <a (click)="router.navigate(['/policy'])" tabindex="0">Datenschutz</a>
          </p>

          <!-- Error -->
          <div *ngIf="state === 'error'" class="alert alert--error" role="alert">
            <span class="material-symbols-outlined ms-fill">error</span>
            <div>
              <strong>Das hat leider nicht geklappt.</strong>
              <p>Schreib mir bitte direkt eine <a href="mailto:hi@leonards-brandenburger-it.de">E-Mail</a>.</p>
            </div>
          </div>

        </form>

      </div>

    </div>
  </div>
</section>