<header class="site-header" role="banner">
  <div class="container header__inner">

    <!-- Logo als Button für besseres Touch-Handling -->
    <button type="button" class="brand-btn" (click)="routeTo('/', $event)" aria-label="Zur Startseite">
      <img class="brand" src="assets/logos/lm_s.png" alt="LeonardsMedia"
        decoding="async" loading="eager" fetchpriority="high" />
      <span class="brand-name">MailFlow</span>
    </button>

    <nav id="primary-nav" class="nav" [class.open]="open">
      <div class="nav__main">
        <!-- Jeder Link schließt explizit das Dropdown UND das Mobile-Menu -->
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
          (click)="servicesDropdownOpen = false; closeMenu()">
          <span class="material-symbols-outlined ms-size-18">home</span>
          Home
        </a>

        <a routerLink="/emails" routerLinkActive="active" (click)="servicesDropdownOpen = false; closeMenu()">
          <span class="material-symbols-outlined ms-size-18">inbox</span>
          Posteingang
        </a>
        <a routerLink="/templates" routerLinkActive="active" (click)="servicesDropdownOpen = false; closeMenu()">
          <span class="material-symbols-outlined ms-size-18">description</span>
          Vorlagen
        </a>
        <a routerLink="/history" routerLinkActive="active" (click)="servicesDropdownOpen = false; closeMenu()">
          <span class="material-symbols-outlined ms-size-18">history</span>
          Verlauf
        </a>
        <a *ngIf="user?.role === UserRole.ADMIN" routerLink="/admin" routerLinkActive="active"
          class="nav-link--admin-main" (click)="servicesDropdownOpen = false; closeMenu()">
          <span class="material-symbols-outlined ms-size-18">admin_panel_settings</span>
          Admin
        </a>
      </div>

      <div class="nav__auth">
        <ng-container *ngIf="!user">
          <a routerLink="/login" routerLinkActive="active" class="nav-link--primary"
            (click)="servicesDropdownOpen = false; closeMenu()">
            <span class="material-symbols-outlined ms-size-20">login</span>
            Login
          </a>
        </ng-container>

        <ng-container *ngIf="user">
          <a routerLink="/profile" routerLinkActive="active" class="nav-link--icon" title="Profil"
            (click)="servicesDropdownOpen = false; closeMenu()">
            <span class="material-symbols-outlined ms-size-22 ms-fill">account_circle</span>
          </a>

          <button class="nav-link--icon nav-link--logout" type="button" (click)="servicesDropdownOpen = false; logout()"
            title="Ausloggen">
            <span class="material-symbols-outlined ms-size-22">logout</span>
          </button>
        </ng-container>
      </div>
    </nav>

    <div class="header__mobile-actions">

      <button class="nav-toggle" type="button" [attr.aria-expanded]="open"
        [attr.aria-label]="open ? 'Menü schließen' : 'Menü öffnen'" (click)="toggle($event)">
        <span class="material-symbols-outlined">{{ open ? 'close' : 'menu' }}</span>
      </button>
    </div>
  </div>

  <div class="backdrop" *ngIf="open" (click)="toggle($event)"></div>
</header>